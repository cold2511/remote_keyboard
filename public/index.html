<!DOCTYPE html>
<html>
<head>
  <title>Protected Keyboard Emulator</title>
  <style>
    #content { display: none; }
    button { margin: 4px; padding: 10px; font-size: 16px; }
    .active { background-color: yellow; }
    .wide { width: 60px; }
    .extra-wide { width: 120px; }
  </style>
</head>
<body>
  <div id="content">
    <h2>üì± Phone Keyboard ‚Üí üñ•Ô∏è PC</h2>

    <div>
      <button id="shift">Shift</button>
      <button id="ctrl">Ctrl</button>
      <button id="alt">Alt</button>
    </div>

    <div id="keyboard"></div>
  </div>

  <script>
    let keycount=0;
    async function checkPassword() {
      const password = prompt("Enter password to access this page:");

      const response = await fetch('/check-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password })
      });

      const result = await response.json();

      if (result.success) {
        document.getElementById('content').style.display = 'block';
        initKeyboard();
      } else {
        document.body.innerHTML = "<h2>Access Denied</h2><p>Wrong password.</p>";
      }
    }

    checkPassword();

    function initKeyboard() {
      const socket = new WebSocket("ws://" + location.hostname + ":3000");

      const keys = [
        "q","w","e","r","t","y","u","i","o","p",
        "a","s","d","f","g","h","j","k","l",
        "z","x","c","v","b","n","m",
        "1","2","3","4","5","6","7","8","9","0",
        ".", ",", "space", "enter", "backspace","ArrowUp","ArrowDown",
        "ArrowLeft","ArrowRight","?",";","-","=","[","]","'"
      ];

      const modifiers = {
        shift: false,
        ctrl: false,
        alt: false
      };

      function sendKey(key) {
        const stime=Date.now();
        keycount++;
        socket.send(JSON.stringify({
          keycount:keycount,
          stime:stime,
          key: key,
          ...modifiers
        }));
        if (modifiers.shift) {
          modifiers.shift = false;
          shiftBtn.classList.remove("active");
        }
      }

      const keyboard = document.getElementById("keyboard");

      keys.forEach(k => {
        const btn = document.createElement("button");

        let label = k;
        if (k === "space") label = "‚ê£";
        if (k === "enter") label = "‚Üµ";
        if (k === "backspace") label = "‚å´";
        if (k === "ArrowUp") label = "‚Üë";
        if (k === "ArrowDown") label = "‚Üì";
        if (k === "ArrowLeft") label = "‚Üê";
        if (k === "ArrowRight") label = "‚Üí";
        if(k==="?")label ="? /";
        if(k==="=")label="+ =";
        if(k===";")label=": ;";
        if(k===".")label="> .";
        if(k===",")label="< ,";
        if(k==="]")label="} ]";
        if(k==="[")label="{ [";
        if(k==="-")label="- _";
        if(k==="1")label="1 !";
        if(k==="2")label="2 @";
        if(k==="3")label="3 #";
        if(k==="4")label="4 $";
        if(k==="5")label="5 %";
        if(k==="6")label="6 ^";
        if(k==="7")label="7 &";
        if(k==="8")label="8 *";
        if(k==="9")label="9 (";
        if(k==="0")label="0 )";

        btn.textContent = label;

        if (k === "space") {
          btn.classList.add("extra-wide");
        } else if (k.length > 1) {
          btn.classList.add("wide");
        }

        btn.onclick = () => sendKey(k);
        keyboard.appendChild(btn);
        
      });

      const shiftBtn = document.getElementById("shift");
      shiftBtn.onclick = () => {
        modifiers.shift = !modifiers.shift;
        shiftBtn.classList.toggle("active", modifiers.shift);
      };

      const ctrlBtn = document.getElementById("ctrl");
      ctrlBtn.onclick = () => {
        modifiers.ctrl = !modifiers.ctrl;
        ctrlBtn.classList.toggle("active", modifiers.ctrl);
      };

      const altBtn = document.getElementById("alt");
      altBtn.onclick = () => {
        modifiers.alt = !modifiers.alt;
        altBtn.classList.toggle("active", modifiers.alt);
      };
    }
  </script>
</body>
</html>